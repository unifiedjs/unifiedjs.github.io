<!doctypehtml><html lang=en><meta charset=utf8><title>Create a rehype plugin - unified</title><meta content="width=device-width,initial-scale=1"name=viewport><link href=/rss.xml rel=alternate title=unifiedjs.com type=application/rss+xml><link href=//github.com rel=preconnect><link href=//images.opencollective.com rel=preconnect><link href=//esm.sh/@wooorm/starry-night@3/style/both.css rel=stylesheet><link href=/index.css rel=stylesheet><link href=/big.css rel=stylesheet media=(min-width:36em)><link href=/dark.css rel=stylesheet media=(prefers-color-scheme:dark)><link href=https://unifiedjs.com/learn/guide/create-a-rehype-plugin/ rel=canonical><meta content="Guide that shows how to create a rehype plugin"name=description><meta content=guide,hast,plugin,rehype,ast,parse,process,stringify,transform,unified name=keywords><meta content="Titus Wormer"name=author><meta content="© 2024 Titus Wormer"name=copyright><meta content=#0366d6 name=theme-color><meta content=article property=og:type><meta content=unified property=og:site_name><meta content=https://unifiedjs.com/learn/guide/create-a-rehype-plugin/ property=og:url><meta content="Create a rehype plugin"property=og:title><meta content="Guide that shows how to create a rehype plugin"property=og:description><meta content=https://unifiedjs.com/image/cover-1200.png property=og:image><meta content="We compile content to syntax trees and syntax trees to content. We also provide hundreds of packages to work on the trees in between. You can build on the unified collective to make all kinds of interesting things."property=og:image:alt><meta content=1200 property=og:image:width><meta content=690 property=og:image:height><meta content=2024-08-13T00:00:00.000Z property=article:published_time><meta content=2024-08-13T00:00:00.000Z property=article:modified_time><meta content=guide property=article:tag><meta content=hast property=article:tag><meta content=plugin property=article:tag><meta content=rehype property=article:tag><script defer src=/browser.js></script><script defer src=/search.js></script><link href=data:image/x-icon;, rel="shortcut icon"type=image/x-icon><header class=container><div class=row-l><h1><a href=/ class=unified><span class=hl>uni</span>fied</a></h1><nav class="flex row-l"aria-label="Main navigation"><ol class="flex row"><li><a href=/explore/>Explore</a><li><a href=../../>Learn</a><li><a href=/community/>Community</a></ol><ol class="row x-show-l justify-end-l"><li><a href=//github.com/unifiedjs><svg class="icon x-show-l"height=24 role=img viewBox="0 0 16 16"width=24 aria-label=GitHub><path d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z"fill=currentcolor clip-rule=evenodd fill-rule=evenodd /></svg><span class=x-hide-l>GitHub</span></a></ol></nav></div></header><section class=container><div class="row-l column-l"><h2><a href=../../>Learn</a><span class="lowlight separator">/</span><a href=../>Guide</a><span class="lowlight separator">/</span><span class=content><a href rel=canonical>Create a rehype plugin</a></span></h2></div></section><main class=container><div class="content article"><h2 id=create-a-rehype-plugin><a href=#create-a-rehype-plugin class=anchor aria-label="Link to self"><svg class=icon height=18 role=img viewBox="0 0 16 16"width=18 aria-hidden=true><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"fill=currentcolor /></svg></a>Create a rehype plugin</h2><p>This guide shows how to create a plugin for <a href=/explore/project/rehypejs/rehype/ class=rehype><span class=hl>re</span>hype</a> that adds <code>id</code> attributes to headings.<blockquote><p>Stuck? Have an idea for another guide? See <a href=//github.com/unifiedjs/.github/blob/main/support.md rel="nofollow noopener noreferrer"><code>support.md</code></a>.</blockquote><h3 id=contents><a href=#contents class=anchor aria-label="Link to self"><svg class=icon height=18 role=img viewBox="0 0 16 16"width=18 aria-hidden=true><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"fill=currentcolor /></svg></a>Contents</h3><ul><li><a href=#case>Case</a><li><a href=#setting-up>Setting up</a><li><a href=#plugin>Plugin</a></ul><h3 id=case><a href=#case class=anchor aria-label="Link to self"><svg class=icon height=18 role=img viewBox="0 0 16 16"width=18 aria-hidden=true><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"fill=currentcolor /></svg></a>Case</h3><p>Before we start, let’s first outline what we want to make. Say we have the following file:<pre><code class=language-html>&lt;<span class=pl-ent>h1</span>>Solar System&#60/<span class=pl-ent>h1</span>>
&lt;<span class=pl-ent>h2</span>>Formation and evolution&#60/<span class=pl-ent>h2</span>>
&lt;<span class=pl-ent>h2</span>>Structure and composition&#60/<span class=pl-ent>h2</span>>
&lt;<span class=pl-ent>h3</span>>Orbits&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>h3</span>>Composition&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>h3</span>>Distances and scales&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>h3</span>>Interplanetary environment&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>p</span>>…&#60/<span class=pl-ent>p</span>>
</code></pre><p>And we’d like to turn that into:<pre><code class=language-html>&lt;<span class=pl-ent>h1</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>solar-system<span class=pl-pds>"</span></span>>Solar System&#60/<span class=pl-ent>h1</span>>
&lt;<span class=pl-ent>h2</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>formation-and-evolution<span class=pl-pds>"</span></span>>Formation and evolution&#60/<span class=pl-ent>h2</span>>
&lt;<span class=pl-ent>h2</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>structure-and-composition<span class=pl-pds>"</span></span>>Structure and composition&#60/<span class=pl-ent>h2</span>>
&lt;<span class=pl-ent>h3</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>orbits<span class=pl-pds>"</span></span>>Orbits&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>h3</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>composition<span class=pl-pds>"</span></span>>Composition&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>h3</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>distances-and-scales<span class=pl-pds>"</span></span>>Distances and scales&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>h3</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>interplanetary-environment<span class=pl-pds>"</span></span>>Interplanetary environment&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>p</span>>…&#60/<span class=pl-ent>p</span>>
</code></pre><p>In the next step we’ll write the code to use our plugin.<h3 id=setting-up><a href=#setting-up class=anchor aria-label="Link to self"><svg class=icon height=18 role=img viewBox="0 0 16 16"width=18 aria-hidden=true><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"fill=currentcolor /></svg></a>Setting up</h3><p>Let’s set up a project. Create a folder, <code>example</code>, enter it, and initialize a new project:<pre><code class=language-sh>mkdir example
<span class=pl-c1>cd</span> example
npm init -y
</code></pre><p>Then make sure the project is a module, so that <code>import</code> and <code>export</code> work, by changing <code>package.json</code>:<pre><code class=language-diff><span class=pl-md>--- a/package.json</span>
<span class=pl-mi1>+++ b/package.json</span>
<span class=pl-mdr>@@ -1,6 +1,7 @@</span>
 {
   "name": "example",
   "version": "1.0.0",
<span class=pl-mi1>+  "type": "module",</span>
   "main": "index.js",
   "scripts": {
     "test": "echo \"Error: no test specified\" &#38&#38 exit 1"
</code></pre><p>Make sure <code>input.html</code> exists with:<pre><code class=language-html>&lt;<span class=pl-ent>h1</span>>Solar System&#60/<span class=pl-ent>h1</span>>
&lt;<span class=pl-ent>h2</span>>Formation and evolution&#60/<span class=pl-ent>h2</span>>
&lt;<span class=pl-ent>h2</span>>Structure and composition&#60/<span class=pl-ent>h2</span>>
&lt;<span class=pl-ent>h3</span>>Orbits&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>h3</span>>Composition&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>h3</span>>Distances and scales&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>h3</span>>Interplanetary environment&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>p</span>>…&#60/<span class=pl-ent>p</span>>
</code></pre><p>Now, let’s create an <code>example.js</code> file that will process our file and report any found problems.<div class="highlight highlight-js"><pre><code class="language-js twoslash"><span class=pl-k>import</span> <span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-0><span class=pl-smi>fs</span></span> <span class=pl-k>from</span> <span class=pl-s><span class=pl-pds>'</span>node:fs/promises<span class=pl-pds>'</span></span>
<span class=pl-k>import</span> {<span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-1><span class=pl-smi>rehype</span></span>} <span class=pl-k>from</span> <span class=pl-s><span class=pl-pds>'</span>rehype<span class=pl-pds>'</span></span>
<span class=pl-k>import</span> <span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-2><span class=pl-smi>rehypeSlug</span></span> <span class=pl-k>from</span> <span class=pl-s><span class=pl-pds>'</span>./plugin.js<span class=pl-pds>'</span></span>

<span class=pl-k>const</span> <span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-3><span class=pl-c1>document</span></span> <span class=pl-k>=</span> <span class=pl-k>await</span> <span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-4><span class=pl-smi>fs</span></span>.<span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-5><span class=pl-en>readFile</span></span>(<span class=pl-s><span class=pl-pds>'</span>input.html<span class=pl-pds>'</span></span>, <span class=pl-s><span class=pl-pds>'</span>utf8<span class=pl-pds>'</span></span>)

<span class=pl-k>const</span> <span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-6><span class=pl-c1>file</span></span> <span class=pl-k>=</span> <span class=pl-k>await</span> <span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-7><span class=pl-en>rehype</span></span>()
  .<span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-8><span class=pl-c1>data</span></span>(<span class=pl-s><span class=pl-pds>'</span>settings<span class=pl-pds>'</span></span>, {<span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-9>fragment</span><span class=pl-k>:</span> <span class=pl-c1>true</span>})
  .<span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-10><span class=pl-en>use</span></span>(<span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-11>rehypeSlug</span>)
  .<span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-12><span class=pl-en>process</span></span>(<span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-13><span class=pl-c1>document</span></span>)

<span class=pl-k>await</span> <span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-14><span class=pl-smi>fs</span></span>.<span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-15><span class=pl-en>writeFile</span></span>(<span class=pl-s><span class=pl-pds>'</span>output.html<span class=pl-pds>'</span></span>, <span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-16><span class=pl-c1>String</span></span>(<span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-fpitpafS-17>file</span>))
</code></pre><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-0 popover><pre class=rehype-twoslash-popover-code><code class=language-ts>(<span class=pl-smi>alias</span>) <span class=pl-k>module</span> <span class=pl-s><span class=pl-pds>"</span>node:fs/promises<span class=pl-pds>"</span></span>
<span class=pl-k>import</span> <span class=pl-smi>fs</span></code></pre></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-1 popover><pre class=rehype-twoslash-popover-code><code class=language-ts>(<span class=pl-smi>alias</span>) <span class=pl-k>const</span> <span class=pl-c1>rehype</span><span class=pl-k>:</span> <span class=pl-en>Processor</span>&lt;<span class=pl-en>Root</span>, <span class=pl-c1>undefined</span>, <span class=pl-c1>undefined</span>, <span class=pl-en>Root</span>, <span class=pl-c1>string</span>>
<span class=pl-k>import</span> <span class=pl-smi>rehype</span></code></pre><div class=rehype-twoslash-popover-description><p>Create a new unified processor that already uses <code>rehype-parse</code> and <code>rehype-stringify</code>.</div></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-2 popover><pre class=rehype-twoslash-popover-code><code class=language-ts>(<span class=pl-smi>alias</span>) <span class=pl-k>function</span> <span class=pl-en>rehypeSlug</span>()<span class=pl-k>:</span> (<span class=pl-v>tree</span><span class=pl-k>:</span> <span class=pl-en>Root</span>) <span class=pl-k>=></span> <span class=pl-c1>undefined</span>
<span class=pl-k>import</span> <span class=pl-smi>rehypeSlug</span></code></pre></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-3 popover><pre class=rehype-twoslash-popover-code><code class=language-ts><span class=pl-k>const</span> <span class=pl-c1>document</span><span class=pl-k>:</span> <span class=pl-c1>string</span></code></pre></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-4 popover><pre class=rehype-twoslash-popover-code><code class=language-ts>(<span class=pl-smi>alias</span>) <span class=pl-k>module</span> <span class=pl-s><span class=pl-pds>"</span>node:fs/promises<span class=pl-pds>"</span></span>
<span class=pl-k>import</span> <span class=pl-smi>fs</span></code></pre></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-5 popover><pre class=rehype-twoslash-popover-code><code class=language-ts><span class=pl-k>function</span> <span class=pl-en>readFile</span>(<span class=pl-v>path</span><span class=pl-k>:</span> <span class=pl-en>PathLike</span> <span class=pl-k>|</span> <span class=pl-en>fs</span>.<span class=pl-en>FileHandle</span>, <span class=pl-en>options</span><span class=pl-k>:</span> ({
    <span class=pl-v>encoding</span><span class=pl-k>:</span> <span class=pl-en>BufferEncoding</span>;
    <span class=pl-v>flag</span><span class=pl-k>?:</span> <span class=pl-en>OpenMode</span> <span class=pl-k>|</span> <span class=pl-c1>undefined</span>;
} <span class=pl-k>&amp</span> <span class=pl-en>EventEmitter</span>&lt;<span class=pl-en>T</span> <span class=pl-k>extends</span> <span class=pl-en>EventMap</span>&lt;<span class=pl-en>T</span>> = <span class=pl-en>DefaultEventMap</span>>.<span class=pl-en>Abortable</span>) <span class=pl-k>|</span> <span class=pl-en>BufferEncoding</span>)<span class=pl-k>:</span> <span class=pl-en>Promise</span>&lt;<span class=pl-c1>string</span>> (+<span class=pl-c1>2</span> <span class=pl-en>overloads</span>)</code></pre><div class=rehype-twoslash-popover-description><p>Asynchronously reads the entire contents of a file.<ul><li><strong>@param</strong> path A path to a file. If a <abbr title="Uniform resource locator"class=first>URL</abbr> is provided, it must use the <code>file:</code> protocol. If a <code>FileHandle</code> is provided, the underlying file will <em>not</em> be closed automatically.<li><strong>@param</strong> options An object that may contain an optional flag. If a flag is not provided, it defaults to <code>'r'</code>.</ul></div></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-6 popover><pre class=rehype-twoslash-popover-code><code class=language-ts><span class=pl-k>const</span> <span class=pl-c1>file</span><span class=pl-k>:</span> <span class=pl-en>VFile</span></code></pre></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-7 popover><pre class=rehype-twoslash-popover-code><code class=language-ts>(<span class=pl-smi>alias</span>) <span class=pl-en>rehype</span>(): <span class=pl-smi>Processor</span><span class=pl-k>&lt;</span><span class=pl-smi>Root</span>, <span class=pl-c1>undefined</span>, <span class=pl-c1>undefined</span>, <span class=pl-smi>Root</span>, <span class=pl-smi>string</span><span class=pl-k>></span>
<span class=pl-k>import</span> <span class=pl-smi>rehype</span></code></pre><div class=rehype-twoslash-popover-description><p>Create a new unified processor that already uses <code>rehype-parse</code> and <code>rehype-stringify</code>.</div></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-8 popover><pre class=rehype-twoslash-popover-code><code class=language-ts>(<span class=pl-smi>method</span>) <span class=pl-smi>Processor</span><span class=pl-k>&lt;</span><span class=pl-smi>Root</span>, <span class=pl-c1>undefined</span>, <span class=pl-c1>undefined</span>, <span class=pl-smi>Root</span>, <span class=pl-smi>string</span><span class=pl-k>></span>.<span class=pl-c1>data</span>&lt;<span class=pl-s><span class=pl-pds>"</span>settings<span class=pl-pds>"</span></span>>(<span class=pl-smi>key</span>: <span class=pl-s><span class=pl-pds>"</span>settings<span class=pl-pds>"</span></span>, <span class=pl-smi>value</span>: <span class=pl-smi>Settings</span> <span class=pl-k>|</span> <span class=pl-c1>undefined</span>): <span class=pl-en>Processor</span>&lt;<span class=pl-en>Root</span>, <span class=pl-c1>undefined</span>, <span class=pl-c1>undefined</span>, <span class=pl-en>Root</span>, <span class=pl-c1>string</span>> (<span class=pl-k>+</span><span class=pl-c1>3</span> <span class=pl-smi>overloads</span>)</code></pre><div class=rehype-twoslash-popover-description><p>Configure the processor with info available to all plugins. Information is stored in an object.<p>Typically, options can be given to a specific plugin, but sometimes it makes sense to have information shared with several plugins. For example, a list of <abbr title="Hypertext markup language"class=first>HTML</abbr> elements that are self-closing, which is needed during all phases.<blockquote><p><strong>Note</strong>: setting information cannot occur on <em>frozen</em> processors. Call the processor first to create a new unfrozen processor.</blockquote><blockquote><p><strong>Note</strong>: to register custom data in TypeScript, augment the</blockquote><p>{@linkcode Data } interface.<ul><li><strong>@example</strong> This example show how to get and set info:<pre><code class=language-js><span class=pl-k>import</span> {<span class=pl-smi>unified</span>} <span class=pl-k>from</span> <span class=pl-s><span class=pl-pds>'</span>unified<span class=pl-pds>'</span></span>

<span class=pl-k>const</span> <span class=pl-c1>processor</span> <span class=pl-k>=</span> <span class=pl-en>unified</span>().<span class=pl-c1>data</span>(<span class=pl-s><span class=pl-pds>'</span>alpha<span class=pl-pds>'</span></span>, <span class=pl-s><span class=pl-pds>'</span>bravo<span class=pl-pds>'</span></span>)

<span class=pl-smi>processor</span>.<span class=pl-c1>data</span>(<span class=pl-s><span class=pl-pds>'</span>alpha<span class=pl-pds>'</span></span>) <span class=pl-c>// => 'bravo'</span>

<span class=pl-smi>processor</span>.<span class=pl-c1>data</span>() <span class=pl-c>// => {alpha: 'bravo'}</span>

<span class=pl-smi>processor</span>.<span class=pl-c1>data</span>({charlie<span class=pl-k>:</span> <span class=pl-s><span class=pl-pds>'</span>delta<span class=pl-pds>'</span></span>})

<span class=pl-smi>processor</span>.<span class=pl-c1>data</span>() <span class=pl-c>// => {charlie: 'delta'}</span>
</code></pre><li><strong>@template</strong> {keyof Data} Key<li><strong>@overload</strong><li><strong>@overload</strong><li><strong>@overload</strong><li><strong>@overload</strong><li><strong>@param</strong> key Key to get or set, or entire dataset to set, or nothing to get the entire dataset (optional).<li><strong>@param</strong> value Value to set (optional).<li><strong>@returns</strong> The current processor when setting, the value at <code>key</code> when getting, or the entire dataset when getting without key.</ul></div></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-9 popover><pre class=rehype-twoslash-popover-code><code class=language-ts>(<span class=pl-smi>property</span>) <span class=pl-smi>fragment</span><span class=pl-k>?:</span> <span class=pl-smi>boolean</span> <span class=pl-k>|</span> <span class=pl-c1>null</span> <span class=pl-k>|</span> <span class=pl-c1>undefined</span></code></pre><div class=rehype-twoslash-popover-description><p>Specify whether to parse a fragment, instead of a complete document (default: <code>false</code>).<p>In document mode, unopened <code>html</code>, <code>head</code>, and <code>body</code> elements are opened in just the right places.</div></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-10 popover><pre class=rehype-twoslash-popover-code><code class=language-ts>(<span class=pl-smi>method</span>) <span class=pl-smi>Processor</span><span class=pl-k>&lt;</span><span class=pl-smi>Root</span>, <span class=pl-c1>undefined</span>, <span class=pl-c1>undefined</span>, <span class=pl-smi>Root</span>, <span class=pl-smi>string</span><span class=pl-k>></span>.<span class=pl-en>use</span>&#60[], <span class=pl-en>Root</span>, <span class=pl-c1>undefined</span>>(<span class=pl-smi>plugin</span>: <span class=pl-c1>Plugin</span><span class=pl-k>&lt;</span>[], <span class=pl-smi>Root</span>, <span class=pl-c1>undefined</span><span class=pl-k>></span>, <span class=pl-k>...</span><span class=pl-smi>parameters</span>: [] <span class=pl-k>|</span> [<span class=pl-smi>boolean</span>]): <span class=pl-en>Processor</span>&lt;<span class=pl-en>Root</span>, <span class=pl-en>Root</span>, <span class=pl-c1>undefined</span>, <span class=pl-en>Root</span>, <span class=pl-c1>string</span>> (<span class=pl-k>+</span><span class=pl-c1>2</span> <span class=pl-smi>overloads</span>)</code></pre><div class=rehype-twoslash-popover-description><p>Configure the processor to use a plugin, a list of usable values, or a preset.<p>If the processor is already using a plugin, the previous plugin configuration is changed based on the options that are passed in. In other words, the plugin is not added a second time.<blockquote><p><strong>Note</strong>: <code>use</code> cannot be called on <em>frozen</em> processors. Call the processor first to create a new unfrozen processor.</blockquote><ul><li><strong>@example</strong> There are many ways to pass plugins to <code>.use()</code>. This example gives an overview:<pre><code class=language-js><span class=pl-k>import</span> {<span class=pl-smi>unified</span>} <span class=pl-k>from</span> <span class=pl-s><span class=pl-pds>'</span>unified<span class=pl-pds>'</span></span>

<span class=pl-en>unified</span>()
  <span class=pl-c>// Plugin with options:</span>
  .<span class=pl-en>use</span>(pluginA, {x<span class=pl-k>:</span> <span class=pl-c1>true</span>, y<span class=pl-k>:</span> <span class=pl-c1>true</span>})
  <span class=pl-c>// Passing the same plugin again merges configuration (to `{x: true, y: false, z: true}`):</span>
  .<span class=pl-en>use</span>(pluginA, {y<span class=pl-k>:</span> <span class=pl-c1>false</span>, z<span class=pl-k>:</span> <span class=pl-c1>true</span>})
  <span class=pl-c>// Plugins:</span>
  .<span class=pl-en>use</span>([pluginB, pluginC])
  <span class=pl-c>// Two plugins, the second with options:</span>
  .<span class=pl-en>use</span>([pluginD, [pluginE, {}]])
  <span class=pl-c>// Preset with plugins and settings:</span>
  .<span class=pl-en>use</span>({plugins<span class=pl-k>:</span> [pluginF, [pluginG, {}]], settings<span class=pl-k>:</span> {position<span class=pl-k>:</span> <span class=pl-c1>false</span>}})
  <span class=pl-c>// Settings only:</span>
  .<span class=pl-en>use</span>({settings<span class=pl-k>:</span> {position<span class=pl-k>:</span> <span class=pl-c1>false</span>}})
</code></pre><li><strong>@template</strong> {Array} [Parameters=[]]<li><strong>@template</strong> {Node | string | undefined} [Input=undefined]<li><strong>@template</strong> [Output=Input]<li><strong>@overload</strong><li><strong>@overload</strong><li><strong>@overload</strong><li><strong>@param</strong> value Usable value.<li><strong>@param</strong> parameters Parameters, when a plugin is given as a usable value.<li><strong>@returns</strong> Current processor.</ul></div></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-11 popover><pre class=rehype-twoslash-popover-code><code class=language-ts>(<span class=pl-smi>alias</span>) <span class=pl-k>function</span> <span class=pl-en>rehypeSlug</span>()<span class=pl-k>:</span> (<span class=pl-v>tree</span><span class=pl-k>:</span> <span class=pl-en>Root</span>) <span class=pl-k>=></span> <span class=pl-c1>undefined</span>
<span class=pl-k>import</span> <span class=pl-smi>rehypeSlug</span></code></pre></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-12 popover><pre class=rehype-twoslash-popover-code><code class=language-ts>(<span class=pl-smi>method</span>) <span class=pl-smi>Processor</span><span class=pl-k>&lt;</span><span class=pl-smi>Root</span>, <span class=pl-smi>Root</span>, <span class=pl-c1>undefined</span>, <span class=pl-smi>Root</span>, <span class=pl-smi>string</span><span class=pl-k>></span>.<span class=pl-en>process</span>(<span class=pl-smi>file</span><span class=pl-k>?:</span> <span class=pl-smi>Compatible</span> <span class=pl-k>|</span> <span class=pl-c1>undefined</span>): <span class=pl-c1>Promise</span>&lt;<span class=pl-en>VFile</span>> (<span class=pl-k>+</span><span class=pl-c1>1</span> <span class=pl-smi>overload</span>)</code></pre><div class=rehype-twoslash-popover-description><p>Process the given file as configured on the processor.<blockquote><p><strong>Note</strong>: <code>process</code> freezes the processor if not already <em>frozen</em>.</blockquote><blockquote><p><strong>Note</strong>: <code>process</code> performs the parse, run, and stringify phases.</blockquote><ul><li><strong>@overload</strong><li><strong>@overload</strong><li><strong>@param</strong> file File (optional); typically <code>string</code> or <code>VFile</code>]; any value accepted as <code>x</code> in <code>new VFile(x)</code>.<li><strong>@param</strong> done Callback (optional).<li><strong>@returns</strong> Nothing if <code>done</code> is given. Otherwise a promise, rejected with a fatal error or resolved with the processed file. The parsed, transformed, and compiled value is available at <code>file.value</code> (see note).<blockquote><p><strong>Note</strong>: unified typically compiles by serializing: most compilers return <code>string</code> (or <code>Uint8Array</code>). Some compilers, such as the one configured with <a href=/explore/package/rehype-react/><code>rehype-react</code></a>, return other values (in this case, a React tree). If you’re using a compiler that doesn’t serialize, expect different result values.<p>To register custom results in TypeScript, add them to {@linkcode CompileResultMap}.</blockquote></ul></div></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-13 popover><pre class=rehype-twoslash-popover-code><code class=language-ts><span class=pl-k>const</span> <span class=pl-c1>document</span><span class=pl-k>:</span> <span class=pl-c1>string</span></code></pre></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-14 popover><pre class=rehype-twoslash-popover-code><code class=language-ts>(<span class=pl-smi>alias</span>) <span class=pl-k>module</span> <span class=pl-s><span class=pl-pds>"</span>node:fs/promises<span class=pl-pds>"</span></span>
<span class=pl-k>import</span> <span class=pl-smi>fs</span></code></pre></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-15 popover><pre class=rehype-twoslash-popover-code><code class=language-ts><span class=pl-k>function</span> <span class=pl-en>writeFile</span>(<span class=pl-v>file</span><span class=pl-k>:</span> <span class=pl-en>PathLike</span> <span class=pl-k>|</span> <span class=pl-en>fs</span>.<span class=pl-en>FileHandle</span>, <span class=pl-v>data</span><span class=pl-k>:</span> <span class=pl-c1>string</span> <span class=pl-k>|</span> <span class=pl-en>NodeJS</span>.<span class=pl-en>ArrayBufferView</span> <span class=pl-k>|</span> <span class=pl-en>Iterable</span>&lt;<span class=pl-c1>string</span> <span class=pl-k>|</span> <span class=pl-en>NodeJS</span>.<span class=pl-en>ArrayBufferView</span>> <span class=pl-k>|</span> <span class=pl-en>AsyncIterable</span>&lt;<span class=pl-c1>string</span> <span class=pl-k>|</span> <span class=pl-en>NodeJS</span>.<span class=pl-en>ArrayBufferView</span>> <span class=pl-k>|</span> <span class=pl-en>Stream</span>, <span class=pl-v>options</span><span class=pl-k>?:</span> (<span class=pl-en>ObjectEncodingOptions</span> <span class=pl-k>&amp</span> {
    <span class=pl-v>mode</span><span class=pl-k>?:</span> <span class=pl-en>Mode</span> <span class=pl-k>|</span> <span class=pl-c1>undefined</span>;
    <span class=pl-v>flag</span><span class=pl-k>?:</span> <span class=pl-en>OpenMode</span> <span class=pl-k>|</span> <span class=pl-c1>undefined</span>;
    <span class=pl-v>flush</span><span class=pl-k>?:</span> <span class=pl-c1>boolean</span> <span class=pl-k>|</span> <span class=pl-c1>undefined</span>;
} <span class=pl-k>&amp</span> <span class=pl-en>EventEmitter</span>&lt;<span class=pl-en>T</span> <span class=pl-k>extends</span> <span class=pl-en>EventMap</span>&lt;<span class=pl-en>T</span>> = <span class=pl-en>DefaultEventMap</span>>.<span class=pl-en>Abortable</span>) <span class=pl-k>|</span> <span class=pl-en>BufferEncoding</span> <span class=pl-k>|</span> <span class=pl-c1>null</span>)<span class=pl-k>:</span> <span class=pl-en>Promise</span>&lt;<span class=pl-c1>void</span>></code></pre><div class=rehype-twoslash-popover-description><p>Asynchronously writes data to a file, replacing the file if it already exists. <code>data</code> can be a string, a buffer, an <a href=//tc39.github.io/ecma262/#sec-asynciterable-interface rel="nofollow noopener noreferrer">AsyncIterable</a>, or an <a href=//developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols#The_iterable_protocol rel="nofollow noopener noreferrer">Iterable</a> object.<p>The <code>encoding</code> option is ignored if <code>data</code> is a buffer.<p>If <code>options</code> is a string, then it specifies the encoding.<p>The <code>mode</code> option only affects the newly created file. See <code>fs.open()</code> for more details.<p>Any specified <code>FileHandle</code> has to support writing.<p>It is unsafe to use <code>fsPromises.writeFile()</code> multiple times on the same file without waiting for the promise to be settled.<p>Similarly to <code>fsPromises.readFile</code> - <code>fsPromises.writeFile</code> is a convenience method that performs multiple <code>write</code> calls internally to write the buffer passed to it. For performance sensitive code consider using <code>fs.createWriteStream()</code> or <code>filehandle.createWriteStream()</code>.<p>It is possible to use an <code>AbortSignal</code> to cancel an <code>fsPromises.writeFile()</code>. Cancelation is "best effort", and some amount of data is likely still to be written.<pre><code class=language-js><span class=pl-k>import</span> { <span class=pl-smi>writeFile</span> } <span class=pl-k>from</span> <span class=pl-s><span class=pl-pds>'</span>node:fs/promises<span class=pl-pds>'</span></span>;
<span class=pl-k>import</span> { <span class=pl-smi>Buffer</span> } <span class=pl-k>from</span> <span class=pl-s><span class=pl-pds>'</span>node:buffer<span class=pl-pds>'</span></span>;

<span class=pl-k>try</span> {
  <span class=pl-k>const</span> <span class=pl-c1>controller</span> <span class=pl-k>=</span> <span class=pl-k>new</span> <span class=pl-en>AbortController</span>();
  <span class=pl-k>const</span> { <span class=pl-c1>signal</span> } <span class=pl-k>=</span> controller;
  <span class=pl-k>const</span> <span class=pl-c1>data</span> <span class=pl-k>=</span> <span class=pl-k>new</span> <span class=pl-en>Uint8Array</span>(<span class=pl-smi>Buffer</span>.<span class=pl-en>from</span>(<span class=pl-s><span class=pl-pds>'</span>Hello Node.js<span class=pl-pds>'</span></span>));
  <span class=pl-k>const</span> <span class=pl-c1>promise</span> <span class=pl-k>=</span> <span class=pl-en>writeFile</span>(<span class=pl-s><span class=pl-pds>'</span>message.txt<span class=pl-pds>'</span></span>, data, { signal });

  <span class=pl-c>// Abort the request before the promise settles.</span>
  <span class=pl-smi>controller</span>.<span class=pl-c1>abort</span>();

  <span class=pl-k>await</span> promise;
} <span class=pl-k>catch</span> (err) {
  <span class=pl-c>// When a request is aborted - err is an AbortError</span>
  <span class=pl-en>console</span>.<span class=pl-c1>error</span>(err);
}
</code></pre><p>Aborting an ongoing request does not abort individual operating system requests but rather the internal buffering <code>fs.writeFile</code> performs.<ul><li><strong>@since</strong> v10.0.0<li><strong>@param</strong> file filename or <code>FileHandle</code><li><strong>@return</strong> Fulfills with <code>undefined</code> upon success.</ul></div></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-16 popover><pre class=rehype-twoslash-popover-code><code class=language-ts><span class=pl-k>var</span> <span class=pl-smi>String</span><span class=pl-k>:</span> <span class=pl-en>StringConstructor</span>
(<span class=pl-v>value</span><span class=pl-k>?:</span> <span class=pl-c1>any</span>) <span class=pl-k>=></span> <span class=pl-smi>string</span></code></pre><div class=rehype-twoslash-popover-description><p>Allows manipulation and formatting of text strings and determination and location of substrings within strings.</div></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-fpitpafS-17 popover><pre class=rehype-twoslash-popover-code><code class=language-ts><span class=pl-k>const</span> <span class=pl-c1>file</span><span class=pl-k>:</span> <span class=pl-en>VFile</span></code></pre></div></div><blockquote><p>Don’t forget to <code>npm install rehype</code>!</blockquote><p>If you read the guide on <a href=../using-unified/>using unified</a>, you’ll see some familiar statements. First, we load dependencies, then we read the file in. We process that file with the plugin we’ll create next and finally we write it out again.<p>Note that we directly depend on <code>rehype</code>. This is a package that exposes a <code>unified</code> processor, and comes with the <abbr title="Hypertext markup language">HTML</abbr> parser and <abbr title="Hypertext markup language">HTML</abbr> compiler attached.<p>Now we’ve got everything set up except for the plugin itself. We’ll do that in the next section.<h3 id=plugin><a href=#plugin class=anchor aria-label="Link to self"><svg class=icon height=18 role=img viewBox="0 0 16 16"width=18 aria-hidden=true><path d="M7.775 3.275C7.64252 3.41717 7.57039 3.60522 7.57382 3.79952C7.57725 3.99382 7.65596 4.1792 7.79337 4.31662C7.93079 4.45403 8.11617 4.53274 8.31047 4.53617C8.50477 4.5396 8.69282 4.46748 8.835 4.335L10.085 3.085C10.2708 2.89918 10.4914 2.75177 10.7342 2.65121C10.977 2.55064 11.2372 2.49888 11.5 2.49888C11.7628 2.49888 12.023 2.55064 12.2658 2.65121C12.5086 2.75177 12.7292 2.89918 12.915 3.085C13.1008 3.27082 13.2482 3.49142 13.3488 3.7342C13.4493 3.97699 13.5011 4.23721 13.5011 4.5C13.5011 4.76279 13.4493 5.023 13.3488 5.26579C13.2482 5.50857 13.1008 5.72917 12.915 5.915L10.415 8.415C10.2292 8.60095 10.0087 8.74847 9.76588 8.84911C9.52308 8.94976 9.26283 9.00157 9 9.00157C8.73716 9.00157 8.47691 8.94976 8.23411 8.84911C7.99132 8.74847 7.77074 8.60095 7.585 8.415C7.44282 8.28252 7.25477 8.21039 7.06047 8.21382C6.86617 8.21725 6.68079 8.29596 6.54337 8.43337C6.40596 8.57079 6.32725 8.75617 6.32382 8.95047C6.32039 9.14477 6.39252 9.33282 6.525 9.475C6.85001 9.80004 7.23586 10.0579 7.66052 10.2338C8.08518 10.4097 8.54034 10.5002 9 10.5002C9.45965 10.5002 9.91481 10.4097 10.3395 10.2338C10.7641 10.0579 11.15 9.80004 11.475 9.475L13.975 6.975C14.6314 6.31858 15.0002 5.4283 15.0002 4.5C15.0002 3.57169 14.6314 2.68141 13.975 2.025C13.3186 1.36858 12.4283 0.999817 11.5 0.999817C10.5717 0.999817 9.68141 1.36858 9.02499 2.025L7.775 3.275ZM3.085 12.915C2.89904 12.7292 2.75152 12.5087 2.65088 12.2659C2.55023 12.0231 2.49842 11.7628 2.49842 11.5C2.49842 11.2372 2.55023 10.9769 2.65088 10.7341C2.75152 10.4913 2.89904 10.2707 3.085 10.085L5.585 7.585C5.77074 7.39904 5.99132 7.25152 6.23411 7.15088C6.47691 7.05023 6.73716 6.99842 7 6.99842C7.26283 6.99842 7.52308 7.05023 7.76588 7.15088C8.00867 7.25152 8.22925 7.39904 8.415 7.585C8.55717 7.71748 8.74522 7.7896 8.93952 7.78617C9.13382 7.78274 9.3192 7.70403 9.45662 7.56662C9.59403 7.4292 9.67274 7.24382 9.67617 7.04952C9.6796 6.85522 9.60748 6.66717 9.475 6.525C9.14999 6.19995 8.76413 5.94211 8.33947 5.7662C7.91481 5.59029 7.45965 5.49974 7 5.49974C6.54034 5.49974 6.08518 5.59029 5.66052 5.7662C5.23586 5.94211 4.85001 6.19995 4.525 6.525L2.025 9.02499C1.36858 9.68141 0.999817 10.5717 0.999817 11.5C0.999817 12.4283 1.36858 13.3186 2.025 13.975C2.68141 14.6314 3.57169 15.0002 4.5 15.0002C5.4283 15.0002 6.31858 14.6314 6.975 13.975L8.225 12.725C8.35748 12.5828 8.4296 12.3948 8.42617 12.2005C8.42274 12.0062 8.34403 11.8208 8.20662 11.6834C8.0692 11.546 7.88382 11.4672 7.68952 11.4638C7.49522 11.4604 7.30717 11.5325 7.165 11.665L5.915 12.915C5.72925 13.1009 5.50867 13.2485 5.26588 13.3491C5.02308 13.4498 4.76283 13.5016 4.5 13.5016C4.23716 13.5016 3.97691 13.4498 3.73411 13.3491C3.49132 13.2485 3.27074 13.1009 3.085 12.915Z"fill=currentcolor /></svg></a>Plugin</h3><p>We’ll need a plugin and for our case also a transform. Let’s create them in our plugin file <code>plugin.js</code>:<div class="highlight highlight-js"><pre><code class="language-js twoslash"><span class=pl-c>/**</span>
<span class=pl-c> * @import {Root} from 'hast'</span>
<span class=pl-c> */</span>

<span class=pl-c>/**</span>
<span class=pl-c> * Add `id`s to headings.</span>
<span class=pl-c> *</span>
<span class=pl-c> * @returns</span>
<span class=pl-c> *   Transform.</span>
<span class=pl-c> */</span>
<span class=pl-k>export</span> <span class=pl-c1>default</span> <span class=pl-k>function</span> <span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-iRfhurft-0><span class=pl-en>rehypeSlug</span></span>() {
  <span class=pl-c>/**</span>
<span class=pl-c>   * @param {Root} tree</span>
<span class=pl-c>   * @return {undefined}</span>
<span class=pl-c>   */</span>
  <span class=pl-k>return</span> <span class=pl-k>function</span> (<span class=rehype-twoslash-popover-target data-popover-target=rehype-twoslash-iRfhurft-1><span class=pl-smi>tree</span></span>) {
  }
}
</code></pre><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-iRfhurft-0 popover><pre class=rehype-twoslash-popover-code><code class=language-ts><span class=pl-k>function</span> <span class=pl-en>rehypeSlug</span>()<span class=pl-k>:</span> (<span class=pl-v>tree</span><span class=pl-k>:</span> <span class=pl-en>Root</span>) <span class=pl-k>=></span> <span class=pl-c1>undefined</span></code></pre><div class=rehype-twoslash-popover-description><p>Add <code>id</code>s to headings.<ul><li><strong>@returns</strong> Transform.</ul></div></div><div class="rehype-twoslash-hover rehype-twoslash-popover"id=rehype-twoslash-iRfhurft-1 popover><pre class=rehype-twoslash-popover-code><code class=language-ts>(<span class=pl-smi>parameter</span>) <span class=pl-en>tree</span>: <span class=pl-smi>Root</span></code></pre><div class=rehype-twoslash-popover-description><ul><li><strong>@param</strong> tree</ul></div></div></div><p>That’s how most plugins start. A function that returns another function.<p>Next, for this use case, we can walk the tree and change nodes with <a href=/explore/package/unist-util-visit/><code>unist-util-visit</code></a>. That’s how many plugins work.<p>Let’s start there, to use <code>unist-util-visit</code> to look for headings:<pre><code class=language-diff><span class=pl-md>--- a/plugin.js</span>
<span class=pl-mi1>+++ b/plugin.js</span>
<span class=pl-mdr>@@ -2,6 +2,8 @@</span>
  * @import {Root} from 'hast'
  */

<span class=pl-mi1>+import {visit} from 'unist-util-visit'</span>
<span class=pl-mi1>+</span>
 /**
  * Add `id`s to headings.
  *
<span class=pl-mdr>@@ -14,5 +16,17 @@</span> export default function rehypeSlug() {
    * @return {undefined}
    */
   return function (tree) {
<span class=pl-mi1>+    visit(tree, 'element', function (node) {</span>
<span class=pl-mi1>+      if (</span>
<span class=pl-mi1>+        node.tagName === 'h1' ||</span>
<span class=pl-mi1>+        node.tagName === 'h2' ||</span>
<span class=pl-mi1>+        node.tagName === 'h3' ||</span>
<span class=pl-mi1>+        node.tagName === 'h4' ||</span>
<span class=pl-mi1>+        node.tagName === 'h5' ||</span>
<span class=pl-mi1>+        node.tagName === 'h6'</span>
<span class=pl-mi1>+      ) {</span>
<span class=pl-mi1>+        console.log(node)</span>
<span class=pl-mi1>+      }</span>
<span class=pl-mi1>+    })</span>
   }
 }
</code></pre><blockquote><p>Don’t forget to <code>npm install unist-util-visit</code>!</blockquote><p>If we now run our example with Node.js, we’ll see that <code>console.log</code> is called:<pre><code class=language-sh>node example.js
</code></pre><pre><code class=language-txt>{
  type: 'element',
  tagName: 'h1',
  properties: {},
  children: [ { type: 'text', value: 'Solar System', position: [Object] } ],
  position: …
}
{
  type: 'element',
  tagName: 'h2',
  properties: {},
  children: [
    {
      type: 'text',
      value: 'Formation and evolution',
      position: [Object]
    }
  ],
  position: …
}
…
</code></pre><p>This output shows that we find our heading element. That’s what we want.<p>Next we want to get a string representation of what is inside the headings. There’s another utility for that: <a href=/explore/package/hast-util-to-string/><code>hast-util-to-string</code></a>.<pre><code class=language-diff><span class=pl-md>--- a/plugin.js</span>
<span class=pl-mi1>+++ b/plugin.js</span>
<span class=pl-mdr>@@ -2,6 +2,7 @@</span>
  * @import {Root} from 'hast'
  */

<span class=pl-mi1>+import {toString} from 'hast-util-to-string'</span>
 import {visit} from 'unist-util-visit'

 /**
<span class=pl-mdr>@@ -25,7 +26,8 @@</span> export default function rehypeSlug() {
         node.tagName === 'h5' ||
         node.tagName === 'h6'
       ) {
<span class=pl-md>-        console.log(node)</span>
<span class=pl-mi1>+        const value = toString(node)</span>
<span class=pl-mi1>+        console.log(value)</span>
       }
     })
   }
</code></pre><blockquote><p>Don’t forget to <code>npm install hast-util-to-string</code>!</blockquote><p>If we now run our example with Node.js, we’ll see the text printed:<pre><code class=language-sh>node example.js
</code></pre><pre><code class=language-txt>Solar System
Formation and evolution
Structure and composition
Orbits
Composition
Distances and scales
Interplanetary environment
</code></pre><p>Then we want to turn that text into slugs. You have many options here. For this case, we’ll use <a href=//github.com/Flet/github-slugger rel="nofollow noopener noreferrer"><code>github-slugger</code></a>.<pre><code class=language-diff><span class=pl-md>--- a/plugin.js</span>
<span class=pl-mi1>+++ b/plugin.js</span>
<span class=pl-mdr>@@ -3,6 +3,7 @@</span>
  */

 import {toString} from 'hast-util-to-string'
<span class=pl-mi1>+import Slugger from 'github-slugger'</span>
 import {visit} from 'unist-util-visit'

 /**
<span class=pl-mdr>@@ -17,6 +18,8 @@</span> export default function rehypeSlug() {
    * @return {undefined}
    */
   return function (tree) {
<span class=pl-mi1>+    const slugger = new Slugger()</span>
<span class=pl-mi1>+</span>
     visit(tree, 'element', function (node) {
       if (
         node.tagName === 'h1' ||
<span class=pl-mdr>@@ -27,7 +30,8 @@</span> export default function rehypeSlug() {
         node.tagName === 'h6'
       ) {
         const value = toString(node)
<span class=pl-md>-        console.log(value)</span>
<span class=pl-mi1>+        const id = slugger.slug(value)</span>
<span class=pl-mi1>+        console.log(id)</span>
       }
     })
   }
</code></pre><blockquote><p>Don’t forget to <code>npm install github-slugger</code>!</blockquote><p>The reason <code>const slugger = new Slugger()</code> is there, is because we want to create a new slugger for each document. If we’d create it outside of the function, we’d reuse the same slugger for each document, which would lead to slugs from different documents being mixed. That becomes a problem for documents with the same headings.<p>If we now run our example with Node.js, we’ll see the slugs printed:<pre><code class=language-sh>node example.js
</code></pre><pre><code class=language-txt>solar-system
formation-and-evolution
structure-and-composition
orbits
composition
distances-and-scales
interplanetary-environment
</code></pre><p>Finally, we want to add the <code>id</code> to the heading elements. This is also a good time to make sure we don’t overwrite existing <code>id</code>s.<pre><code class=language-diff><span class=pl-md>--- a/plugin.js</span>
<span class=pl-mi1>+++ b/plugin.js</span>
<span class=pl-mdr>@@ -22,16 +22,17 @@</span> export default function rehypeSlug() {

     visit(tree, 'element', function (node) {
       if (
<span class=pl-md>-        node.tagName === 'h1' ||</span>
<span class=pl-md>-        node.tagName === 'h2' ||</span>
<span class=pl-md>-        node.tagName === 'h3' ||</span>
<span class=pl-md>-        node.tagName === 'h4' ||</span>
<span class=pl-md>-        node.tagName === 'h5' ||</span>
<span class=pl-md>-        node.tagName === 'h6'</span>
<span class=pl-mi1>+        !node.properties.id &#38&amp</span>
<span class=pl-mi1>+        (node.tagName === 'h1' ||</span>
<span class=pl-mi1>+          node.tagName === 'h2' ||</span>
<span class=pl-mi1>+          node.tagName === 'h3' ||</span>
<span class=pl-mi1>+          node.tagName === 'h4' ||</span>
<span class=pl-mi1>+          node.tagName === 'h5' ||</span>
<span class=pl-mi1>+          node.tagName === 'h6')</span>
       ) {
         const value = toString(node)
         const id = slugger.slug(value)
<span class=pl-md>-        console.log(id)</span>
<span class=pl-mi1>+        node.properties.id = id</span>
       }
     })
   }
</code></pre><p>If we now run our example again with Node…<pre><code class=language-sh>node example.js
</code></pre><p>…and open <code>output.html</code>, we’ll see that the IDs are there!<pre><code class=language-html>&lt;<span class=pl-ent>h1</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>solar-system<span class=pl-pds>"</span></span>>Solar System&#60/<span class=pl-ent>h1</span>>
&lt;<span class=pl-ent>h2</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>formation-and-evolution<span class=pl-pds>"</span></span>>Formation and evolution&#60/<span class=pl-ent>h2</span>>
&lt;<span class=pl-ent>h2</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>structure-and-composition<span class=pl-pds>"</span></span>>Structure and composition&#60/<span class=pl-ent>h2</span>>
&lt;<span class=pl-ent>h3</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>orbits<span class=pl-pds>"</span></span>>Orbits&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>h3</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>composition<span class=pl-pds>"</span></span>>Composition&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>h3</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>distances-and-scales<span class=pl-pds>"</span></span>>Distances and scales&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>h3</span> <span class=pl-e>id</span>=<span class=pl-s><span class=pl-pds>"</span>interplanetary-environment<span class=pl-pds>"</span></span>>Interplanetary environment&#60/<span class=pl-ent>h3</span>>
&lt;<span class=pl-ent>p</span>>…&#60/<span class=pl-ent>p</span>>
</code></pre><p>That’s it! For a complete version of this plugin, see <a href=/explore/package/rehype-slug/><code>rehype-slug</code></a>.<p>If you haven’t already, check out the other articles in the <a href=../../>learn section</a>!</div></main><footer class=container><nav class="flex row-l"><ol class="flex row x-show-l"><li><a href=/ class=unified><span class=hl>uni</span>fied</a><li><a href=/explore/>Explore</a><li><a href=../../>Learn</a><li><a href=/community/>Community</a></ol><ol class="row justify-end-l"><li><a href=/rss.xml>RSS Feed</a><li><a href=//opencollective.com/unified>OpenCollective</a><li><a href=//github.com/unifiedjs>GitHub</a></ol></nav></footer>