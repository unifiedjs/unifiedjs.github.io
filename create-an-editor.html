<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>unified</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="index.css"></head>
  <body>
    <header>
      <h1><a href=".."><span class="hl unified">uni</span>fied</a></h1>
    </header>
    <main>
      <section>
        <h2 id="creating-an-editor"><a class="anchor" href="#creating-an-editor">#</a>Creating an editor</h2>
        <blockquote>
          <p>
            I‚Äôm not entirely sure how to call this thing. ‚ÄúDemo‚Äù is too generic,
            ‚Äúdingus‚Äù too vague, and I think editor is pretty apt. Anyway, drop a line
            on <a href="https://gitter.im/unifiedjs/Lobby">Gitter</a> if you know a better name.
          </p>
        </blockquote>
        <p>
          This guide shows how to create an interactive online editor with unified.
          In it we‚Äôll visualise syntactic properties of text by ‚Äúsyntax highlighting‚Äù
          them. The editor will run in a browser. It‚Äôll be fast as we‚Äôre using
          <a href="https://github.com/Matt-Esch/virtual-dom"><code>virtual-dom</code></a> (but you could use <a href="https://facebook.github.io/react/">React</a> and the like too).
        </p>
        <p>
          For this example we‚Äôll create an app that visualises sentence length.
          It‚Äôs based on a tip by <a href="http://www.garyprovost.com/_i__b__font_size___1__100_ways_to_improve_your_writing___font_size__font_size__2_109049.htm">Gary Provost</a>, and the visualisation is based
          on <a href="https://twitter.com/gregoryciotti/status/639837682844090369">a tweet by @gregoryciotti</a>.
        </p>
        <p>You can also <a href="http://wooorm.com/write-music/">view this project</a> with some more features online.</p>
        <blockquote>
          <p>
            Stuck? A good place to get help fast is <a href="https://gitter.im/unifiedjs/Lobby">Gitter</a>.
            Have an idea for another guide? Share it on Gitter!
          </p>
        </blockquote>
        <article>
          <h3 id="contents"><a class="anchor" href="#contents">#</a>Contents</h3>
          <ul>
            <li><a href="#case">Case</a></li>
            <li><a href="#project-structure">Project structure</a></li>
            <li><a href="#setting-up-javascript">Setting up JavaScript</a></li>
            <li><a href="#natural-language-syntax-tree">Natural language syntax tree</a></li>
            <li><a href="#virtual-dom">Virtual DOM</a></li>
            <li><a href="#highlight">Highlight</a></li>
            <li><a href="#colour">Colour</a></li>
            <li><a href="#squashing-bugs">Squashing bugs</a></li>
            <li><a href="#further-exercises">Further exercises</a></li>
          </ul>
        </article>
        <article>
          <h3 id="case"><a class="anchor" href="#case">#</a>Case</h3>
          <p>
            Before we start, let‚Äôs first outline what we want to make. We want
            to highlight sentences in text based on how many words they have.
            The user should be able to change text, and it should highlight live.
          </p>
          <p>
            We‚Äôll use <a href="https://github.com/sindresorhus/xo">xo</a> as a linter, and <a href="https://github.com/substack/node-browserify">browserify</a> as a bundler to compile
            our JavaScript with <code>require</code> calls to JavaScript that works in the
            browser (you could of course swap those out for your favourite linter
            and bundler).
          </p>
        </article>
        <article>
          <h3 id="project-structure"><a class="anchor" href="#project-structure">#</a>Project structure</h3>
          <p>Let‚Äôs first outline our project structure:</p>
          <pre><code class="language-txt">demo/
‚îú‚îÄ index.js
‚îú‚îÄ build.js
‚îú‚îÄ index.html
‚îú‚îÄ index.css
‚îî‚îÄ package.json
</code></pre>
          <p>
            ...where <code>demo/</code> is our directory, and <code>build.js</code> is the JavaScript
            generated by compiling <code>index.js</code>.
          </p>
          <p>
            Keep <code>index.js</code>, <code>index.html</code>, and <code>index.css</code> empty for now, and fill
            <code>package.json</code> with the following.
          </p>
          <figure class="window gist">
            <figcaption>package.json</figcaption>
            <pre><code class="language-json">{
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"demo"</span>,
  <span class="hljs-attr">"private"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"dependencies"</span>: {},
  <span class="hljs-attr">"devDependencies"</span>: {
    <span class="hljs-attr">"browserify"</span>: <span class="hljs-string">"^14.0.0"</span>,
    <span class="hljs-attr">"xo"</span>: <span class="hljs-string">"^0.18.0"</span>
  },
  <span class="hljs-attr">"scripts"</span>: {
    <span class="hljs-attr">"build"</span>: <span class="hljs-string">"browserify index.js > build.js"</span>,
    <span class="hljs-attr">"lint"</span>: <span class="hljs-string">"xo"</span>,
    <span class="hljs-attr">"test"</span>: <span class="hljs-string">"npm run build &#x26;&#x26; npm run lint"</span>
  },
  <span class="hljs-attr">"xo"</span>: {
    <span class="hljs-attr">"space"</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">"esnext"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"envs"</span>: [
      <span class="hljs-string">"browser"</span>
    ],
    <span class="hljs-attr">"ignore"</span>: [
      <span class="hljs-string">"build.js"</span>
    ]
  }
}</code></pre>
          </figure>
          <blockquote>
            <p>
              <a href="https://docs.npmjs.com/files/package.json#private"><code>private: true</code></a> means you can‚Äôt accidentally publish
              your package to npm.
            </p>
          </blockquote>
          <p>
            Now, after running <code>npm install</code> and <code>npm test</code> you‚Äôll see <code>build.js</code>
            appear too. The above package sets up <a href="https://github.com/sindresorhus/xo">xo</a> as the linter and
            <a href="https://github.com/substack/node-browserify">browserify</a> as the bundler.
          </p>
          <p>Now, fill <code>index.html</code> with the following:</p>
          <figure class="window gist">
            <figcaption>index.html</figcaption>
            <pre><code class="language-html"><span class="hljs-meta">&#x3C;!doctype html></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf8"</span>></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">title</span>></span>demo<span class="hljs-tag">&#x3C;/<span class="hljs-name">title</span>></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"index.css"</span>></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"root"</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"build.js"</span>></span><span class="null"></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">script</span>></span></code></pre>
          </figure>
          <p>
            This links <code>index.css</code> and <code>build.js</code>, and adds an element (<code>#root</code>)
            which we‚Äôll add our editor to later. Oh, did you know that <code>&#x3C;html></code>,
            <code>&#x3C;head></code>, and <code>&#x3C;body></code> are optional? For this example we‚Äôll keep
            the HTML clean, but feel free to add them if you prefer them.
          </p>
        </article>
        <article>
          <h3 id="setting-up-javascript"><a class="anchor" href="#setting-up-javascript">#</a>Setting up JavaScript</h3>
          <p>
            Alright! Now, let‚Äôs set up our JavaScript. Start by adding
            the following to <code>index.js</code>:
          </p>
          <figure class="window gist">
            <figcaption>index.js</figcaption>
            <pre><code class="language-js"><span class="hljs-keyword">var</span> h = <span class="hljs-built_in">require</span>(<span class="hljs-string">'virtual-dom/h'</span>);
<span class="hljs-keyword">var</span> createElement = <span class="hljs-built_in">require</span>(<span class="hljs-string">'virtual-dom/create-element'</span>);
<span class="hljs-keyword">var</span> diff = <span class="hljs-built_in">require</span>(<span class="hljs-string">'virtual-dom/diff'</span>);
<span class="hljs-keyword">var</span> patch = <span class="hljs-built_in">require</span>(<span class="hljs-string">'virtual-dom/patch'</span>);

<span class="hljs-keyword">var</span> root = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'root'</span>);
<span class="hljs-keyword">var</span> tree = render(<span class="hljs-string">'The initial text.'</span>);
<span class="hljs-keyword">var</span> dom = root.appendChild(createElement(tree));

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onchange</span>(<span class="hljs-params">ev</span>) </span>{
  <span class="hljs-keyword">var</span> next = render(ev.target.value);
  dom = patch(dom, diff(tree, next));
  tree = next;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params">text</span>) </span>{
  <span class="hljs-keyword">var</span> node = parse(text);

  <span class="hljs-keyword">return</span> h(<span class="hljs-string">'div'</span>, {<span class="hljs-attr">className</span>: <span class="hljs-string">'editor'</span>}, [
    h(<span class="hljs-string">'div'</span>, {<span class="hljs-attr">key</span>: <span class="hljs-string">'draw'</span>, <span class="hljs-attr">className</span>: <span class="hljs-string">'draw'</span>}, highlight(node)),
    h(<span class="hljs-string">'textarea'</span>, {
      <span class="hljs-attr">key</span>: <span class="hljs-string">'area'</span>,
      <span class="hljs-attr">value</span>: text,
      <span class="hljs-attr">oninput</span>: onchange
    })
  ]);

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse</span>(<span class="hljs-params"></span>) </span>{}

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">highlight</span>(<span class="hljs-params"></span>) </span>{}
}</code></pre>
          </figure>
          <blockquote>
            <p>Don‚Äôt forget to <code>npm install --save virtual-dom</code>.</p>
          </blockquote>
          <p>
            That‚Äôs going a bit fast, I can imagine, if you‚Äôve never seen
            <a href="https://github.com/Matt-Esch/virtual-dom"><code>virtual-dom</code></a> in use before. If that‚Äôs the case, please take
            some time to peruse the <code>virtual-dom</code> docs at your leisure. This guide
            will wait!
          </p>
          <p>To summarise what all these things in the code mean:</p>
          <ul>
            <li><code>h</code> creates ‚Äúvirtual‚Äù nodes</li>
            <li><code>createElement</code> turns them into DOM nodes</li>
            <li><code>diff</code> finds the difference between two virtual nodes</li>
            <li><code>patch</code> applies <code>diff</code> to a DOM node</li>
            <li><code>root</code> is our anchor into the document</li>
            <li><code>tree</code> is the current virtual tree</li>
            <li><code>dom</code> is the current DOM tree</li>
            <li><code>onchange</code> handles any state change (the text in our case)</li>
            <li><code>render</code> creates a new virtual tree based on that state</li>
            <li><code>parse</code> transforms the state into a natural language syntax tree</li>
            <li><code>highlight</code> transforms that syntax tree into a virtual tree</li>
          </ul>
          <p>
            In <code>render</code>, we‚Äôre creating two elements: a <code>&#x3C;div></code> that we‚Äôll draw our
            syntax highlighting in, and a <code>&#x3C;textarea></code> that the user can edit.
            Both are wrapped in a parent <code>&#x3C;div></code>. We‚Äôll style the text area and the
            drawing area exactly the same, and position the text above the drawing
            area, with the following styles.
          </p>
          <figure class="window gist">
            <figcaption>index.css</figcaption>
            <pre><code class="language-css"><span class="hljs-selector-tag">html</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.5</span>;
}

<span class="hljs-selector-class">.editor</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">37em</span>;
  <span class="hljs-attribute">margin</span>: auto;
  <span class="hljs-attribute">overflow</span>: hidden;
}

<span class="hljs-selector-tag">textarea</span>, <span class="hljs-selector-class">.draw</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">outline</span>: none;
  <span class="hljs-attribute">resize</span>: none;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-comment">/* Can‚Äôt use a nice font: kerning renders differently in textareas. */</span>
  <span class="hljs-attribute">font-family</span>: monospace;
  <span class="hljs-attribute">line-height</span>: inherit;
  <span class="hljs-attribute">font-size</span>: inherit;
  <span class="hljs-attribute">background</span>: transparent;
  <span class="hljs-attribute">white-space</span>: pre-wrap;
  <span class="hljs-attribute">word-wrap</span>: break-word;
  <span class="hljs-attribute">font-size</span>: inherit;
  <span class="hljs-attribute">line-height</span>: inherit;
}

<span class="hljs-selector-tag">textarea</span> {
  <span class="hljs-attribute">color</span>: inherit;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.draw</span> {
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
}</code></pre>
          </figure>
          <p>
            That‚Äôs quite a bit of code: mainly to enforce the same styles on our text
            and drawing areas.
          </p>
        </article>
        <article>
          <h3 id="natural-language-syntax-tree"><a class="anchor" href="#natural-language-syntax-tree">#</a>Natural language syntax tree</h3>
          <p>
            Now, let‚Äôs set up our natural language syntax tree parsing. We‚Äôll of
            course use unified, and <a href="https://github.com/wooorm/retext/tree/master/packages/retext-english"><code>retext-english</code></a> to parse English
            natural language.
          </p>
          <p>Change <code>index.js</code> like so:</p>
          <figure class="window gist">
            <figcaption>index.js</figcaption>
            <pre><code class="language-diff">@@ -2,7 +2,10 @@ var h = require('virtual-dom/h');
 var createElement = require('virtual-dom/create-element');
 var diff = require('virtual-dom/diff');
 var patch = require('virtual-dom/patch');
<span class="hljs-addition">var unified = require('unified');</span>
<span class="hljs-addition">var english = require('retext-english');</span>

<span class="hljs-addition">var processor = unified().use(english);</span>
 var root = document.getElementById('root');
 var tree = render('The initial text.');
 var dom = root.appendChild(createElement(tree));
@@ -25,7 +28,9 @@ function render(text) {
     })
   ]);

<span class="hljs-deletion">  function parse() {}</span>
<span class="hljs-addition">  function parse(value) {</span>
<span class="hljs-addition">    return processor.runSync(processor.parse(value));</span>
<span class="hljs-addition">  }</span>

   function highlight() {}
 }</code></pre>
          </figure>
          <blockquote>
            <p>Don‚Äôt forget to <code>npm install --save unified retext-english</code>.</p>
          </blockquote>
          <p>
            Sweet, now we have access to a lot of info on the text. It still doesn‚Äôt
            do anything yet though. Let‚Äôs add some usefulness.
          </p>
        </article>
        <article>
          <h3 id="virtual-dom"><a class="anchor" href="#virtual-dom">#</a>Virtual DOM</h3>
          <p>
            Our next task is to go from a natural language syntax tree to a
            virtual DOM. We already have <code>highlight</code> for that, but it‚Äôs empty,
            so let‚Äôs add code to fill it:
          </p>
          <figure class="window gist">
            <figcaption>index.js</figcaption>
            <pre><code class="language-diff">@@ -32,5 +32,21 @@ function render(text) {
     return processor.runSync(processor.parse(value));
   }

<span class="hljs-deletion">  function highlight() {}</span>
<span class="hljs-addition">  function highlight(node) {</span>
<span class="hljs-addition">    var children = node.children;</span>
<span class="hljs-addition">    var length = children.length;</span>
<span class="hljs-addition">    var index = -1;</span>
<span class="hljs-addition">    var results = [];</span>
<span class="hljs-addition"></span>
<span class="hljs-addition">    while (++index &#x3C; length) {</span>
<span class="hljs-addition">      results = results.concat(one(children[index]));</span>
<span class="hljs-addition">    }</span>
<span class="hljs-addition"></span>
<span class="hljs-addition">    return results;</span>
<span class="hljs-addition">  }</span>
<span class="hljs-addition"></span>
<span class="hljs-addition">  function one(node) {</span>
<span class="hljs-addition">    var result = 'value' in node ? node.value : highlight(node);</span>
<span class="hljs-addition">    return result;</span>
<span class="hljs-addition">  }</span>
 }</code></pre>
          </figure>
          <p>
            <code>highlight</code> searches all children in the given <code>node</code>, and <code>one</code>
            returns either the ‚Äútext content‚Äù of a node, or the result of searching
            its children for text content.
          </p>
          <p>
            If you‚Äôd now run <code>npm test</code> again, and open <code>index.html</code> in your browser,
            you‚Äôll see that the drawing area already has our text (it‚Äôs hidden with
            styles, but you should be able to see it in your web inspector).
          </p>
          <p>
            We need one more thing before we can start highlighting: we need to
            detect sentences, and apply styles to them. Change <code>index.js</code> like so:
          </p>
          <figure class="window gist">
            <figcaption>index.js</figcaption>
            <pre><code class="language-diff">@@ -18,6 +18,7 @@ function onchange(ev) {

 function render(text) {
   var node = parse(text);
<span class="hljs-addition">  var key = 0;</span>

   return h('div', {className: 'editor'}, [
     h('div', {key: 'draw', className: 'draw'}, highlight(node)),
@@ -47,6 +48,19 @@ function render(text) {

   function one(node) {
     var result = 'value' in node ? node.value : highlight(node);
<span class="hljs-addition"></span>
<span class="hljs-addition">    if (node.type === 'SentenceNode') {</span>
<span class="hljs-addition">      key++;</span>
<span class="hljs-addition">      result = h('span', {</span>
<span class="hljs-addition">        key: 's-' + key,</span>
<span class="hljs-addition">        style: {backgroundColor: color(count(node))}</span>
<span class="hljs-addition">      }, result);</span>
<span class="hljs-addition">    }</span>
<span class="hljs-addition"></span>
     return result;
   }
<span class="hljs-addition"></span>
<span class="hljs-addition">  function count() {}</span>
<span class="hljs-addition"></span>
<span class="hljs-addition">  function color() {}</span>
 }</code></pre>
          </figure>
          <blockquote>
            <p><code>key</code> is needed for <code>virtual-dom</code> <a href="https://github.com/Matt-Esch/virtual-dom/tree/master/virtual-hyperscript#key">to be performant</a>.</p>
          </blockquote>
          <p>
            We don‚Äôt colour sentences yet, but there‚Äôs <code>&#x3C;span></code> elements wrapping
            them now. You can see that in action by running <code>npm test</code> again and
            using your web inspector to inspect the drawing area.
          </p>
          <p>
            We‚Äôve also set up two functions to highlight sentences. <code>count</code> will
            count the number of words of a given sentence, and <code>color</code> will pick
            a corresponding colour.
          </p>
        </article>
        <article>
          <h3 id="highlight"><a class="anchor" href="#highlight">#</a>Highlight</h3>
          <p>Now, let‚Äôs add colours. Update <code>index.js</code> like so:</p>
          <figure class="window gist">
            <figcaption>index.js</figcaption>
            <pre><code class="language-diff">@@ -4,6 +4,11 @@ var diff = require('virtual-dom/diff');
 var patch = require('virtual-dom/patch');
 var unified = require('unified');
 var english = require('retext-english');
<span class="hljs-addition">var visit = require('unist-util-visit');</span>
<span class="hljs-addition"></span>
<span class="hljs-addition">var hues = [</span>
<span class="hljs-addition">  0</span>
<span class="hljs-addition">];</span>

 var processor = unified().use(english);
 var root = document.getElementById('root');
@@ -60,7 +65,20 @@ function render(text) {
     return result;
   }

<span class="hljs-deletion">  function count() {}</span>
<span class="hljs-addition">  function count(node) {</span>
<span class="hljs-addition">    var value = 0;</span>
<span class="hljs-addition"></span>
<span class="hljs-addition">    visit(node, 'WordNode', add);</span>

<span class="hljs-addition">    return value;</span>
<span class="hljs-addition"></span>
<span class="hljs-addition">    function add() {</span>
<span class="hljs-addition">      value++;</span>
<span class="hljs-addition">    }</span>
<span class="hljs-addition">  }</span>
<span class="hljs-addition"></span>
<span class="hljs-deletion">  function color() {}</span>
<span class="hljs-addition">  function color(count) {</span>
<span class="hljs-addition">    var val = count &#x3C; hues.length ? hues[count] : hues[hues.length - 1];</span>
<span class="hljs-addition">    return 'hsl(' + [val, '93%', '85%'].join(', ') + ')';</span>
<span class="hljs-addition">  }</span>
 }</code></pre>
          </figure>
          <blockquote>
            <p>Don‚Äôt forget to <code>npm install --save unist-util-visit</code>.</p>
          </blockquote>
          <p>
            The <code>count</code> function searches <code>node</code> for all occurrences of words,
            through <a href="https://github.com/syntax-tree/unist-util-visit"><code>unist-util-visit</code></a>, and returns that count.
          </p>
          <p>
            <code>color</code> takes a number, and returns a nice colour in <abbr title="Hue Saturation Lightness" class="first">HSL</abbr> for it.
            It does so based on if there‚Äôs a corresponding hue for it in <code>hues</code>
            (now just one value). If there‚Äôs no corresponding hue, it uses the last
            specified hue.
          </p>
          <p>
            It‚Äôs not much, but it‚Äôs something. Try it out by running <code>npm test</code> again,
            and viewing <code>index.html</code> in your browser. If everything went okay, you
            should see each sentence highlighted in red.
          </p>
        </article>
        <article>
          <h3 id="colour"><a class="anchor" href="#colour">#</a>Colour</h3>
          <p>
            One colour isn‚Äôt that cool, and we‚Äôre trying to recreate that
            <a href="https://twitter.com/gregoryciotti/status/639837682844090369">visualisation by @gregoryciotti</a>. We need some more colours.
            From that image, I deducted the following hues. But you could of
            course use any hues you like!
          </p>
          <p>To match that image, change <code>hues</code> like so:</p>
          <figure class="window gist">
            <figcaption>index.js</figcaption>
            <pre><code class="language-diff">@@ -7,7 +7,20 @@ var english = require('retext-english');
 var visit = require('unist-util-visit');

 var hues = [
<span class="hljs-addition">  60,</span>
<span class="hljs-addition">  60,</span>
<span class="hljs-addition">  60,</span>
<span class="hljs-addition">  300,</span>
<span class="hljs-addition">  300,</span>
   0,
<span class="hljs-addition">  0,</span>
<span class="hljs-addition">  120,</span>
<span class="hljs-addition">  120,</span>
<span class="hljs-addition">  120,</span>
<span class="hljs-addition">  120,</span>
<span class="hljs-addition">  120,</span>
<span class="hljs-addition">  120,</span>
<span class="hljs-addition">  180</span>
 ];

 var processor = unified().use(english);</code></pre>
          </figure>
        </article>
        <article>
          <h3 id="squashing-bugs"><a class="anchor" href="#squashing-bugs">#</a>Squashing bugs</h3>
          <p>
            üíÉ After running <code>npm test</code> again, and reopening <code>index.html</code> in your browser,
            you should now see <code>The initial text</code> in purple! If you add more sentences,
            they each should receive colours based on how many words they have.
          </p>
          <p>
            If you add more text, you‚Äôll notice that our drawing area grows nicely, but
            our text area does not. That‚Äôs because this example positions the <code>&#x3C;textarea></code>
            absolutely on top of the drawing area. The easiest way to get both areas the
            same height, is with the following slightly hacky code:
          </p>
          <figure class="window gist">
            <figcaption>index.js</figcaption>
            <pre><code class="language-diff">@@ -28,10 +28,13 @@ var root = document.getElementById('root');
 var tree = render('The initial text.');
 var dom = root.appendChild(createElement(tree));

<span class="hljs-addition">setTimeout(resize, 4);</span>
<span class="hljs-addition"></span>
 function onchange(ev) {
   var next = render(ev.target.value);
   dom = patch(dom, diff(tree, next));
   tree = next;
<span class="hljs-addition">  setTimeout(resize, 4);</span>
 }

 function render(text) {
@@ -95,3 +98,10 @@ function render(text) {
     return 'hsl(' + [val, '93%', '85%'].join(', ') + ')';
   }
 }
<span class="hljs-addition"></span>
<span class="hljs-addition">function resize() {</span>
<span class="hljs-addition">  dom.lastChild.rows = Math.ceil(</span>
<span class="hljs-addition">    dom.firstChild.getBoundingClientRect().height /</span>
<span class="hljs-addition">    parseInt(window.getComputedStyle(dom.firstChild).lineHeight, 10)</span>
<span class="hljs-addition">  ) + 1;</span>
<span class="hljs-addition">}</span></code></pre>
          </figure>
          <p>
            This updates the <code>rows</code> attribute on the text area to correspondent with the
            size of the drawing area.
          </p>
        </article>
        <article>
          <h3 id="further-exercises"><a class="anchor" href="#further-exercises">#</a>Further exercises</h3>
          <p>The above code has a few issues:</p>
          <ul>
            <li class="task-list-item">
              <input type="checkbox" disabled> <code>onchange</code> is not <a href="https://www.npmjs.com/package/debounce">debounced</a>, which leads to performance
              issues
            </li>
            <li class="task-list-item"><input type="checkbox" disabled> <code>input</code> events are not supported in some older browsers</li>
            <li class="task-list-item"><input type="checkbox" disabled> The styles aren‚Äôt perfect</li>
            <li class="task-list-item"><input type="checkbox" disabled> and probably some other things!</li>
          </ul>
          <p>
            ...maybe you could solve some? Other than those issues, it‚Äôs a pretty cool
            little demo.
          </p>
          <p>If you haven‚Äôt already, check out the other <a href="/#guides">guides</a>!</p><!--Definitions--></article>
      </section>
    </main>
    <footer>
      <p>made with ‚ù§Ô∏è by <a href="https://github.com/wooorm">@wooorm</a> and <a href="https://github.com/wooorm">https://github.com/unifiedjs/unifiedjs.github.io/graphs/contributors</a></p>
      <p>view the project on <a href="https://github.com/unifiedjs/unified">GitHub</a></p>
      <p>‚òî</p>
    </footer>
    <script src="index.js"></script>
  </body>
</html>
